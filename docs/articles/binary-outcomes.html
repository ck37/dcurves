<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Decision Curve Analysis for Binary Outcomes • dca</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Decision Curve Analysis for Binary Outcomes">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dca</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/binary-outcomes.html">Decision Curve Analysis for Binary Outcomes</a>
    </li>
    <li>
      <a href="../articles/survival-outcomes.html">Decision Curve Analysis for Survival Outcomes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Decision Curve Analysis for Binary Outcomes</h1>
                        <h4 class="author">Daniel D. Sjoberg</h4>
            
            <h4 class="date">2018-03-26</h4>
      
      

    </div>

    
    
<div class="contents">
<div id="introduction-background" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-background" class="anchor"></a>Introduction &amp; Background</h2>
<p>Diagnostic and prognostic models are typically evaluated with measures of accuracy that do not address clinical consequences. Decision-analytic techniques allow assessment of clinical outcomes but often require collection of additional information and may be cumbersome to apply to models that yield a continuous result. Decision curve analysis is a method for evaluating and comparing prediction models that incorporates clinical consequences, requires only the data set on which the models are tested, and can be applied to models that have either continuous or dichotomous results. This document will walk you through how to perform a decision curve analysis (DCA) in many settings, and how to interpret the resulting curves. In DCA prediction models are compared to two default strategies: 1) assume that all patients are test positive and therefore treat everyone, or 2) assume that all patients are test negative and offer treatment to no one. “Treatment” is considered in the widest possible sense, not only drugs, radiotherapy or surgery, but advice, further diagnostic procedures or more intensive monitoring. For more details on DCA, visit decisioncurveanalysis.org. You’ll find the original articles explaining the details of the DCA derivation along with other papers providing more details.</p>
</div>
<div id="motivating-example" class="section level2">
<h2 class="hasAnchor">
<a href="#motivating-example" class="anchor"></a>Motivating Example</h2>
<p>We’ll be working with the example dataset (dca.df), available on our website. The dataset includes information on 750 patients who have recently discovered they have a gene mutation that puts them at a higher risk for harboring cancer. Each patient has been biopsied and we know their cancer status. It is known that older patients with a family history of cancer have a higher probability of harboring cancer. A clinical chemist has recently discovered a marker that she believes can distinguish between patients with and without cancer. We wish to assess whether or not the new marker does indeed identify patients with and without cancer. If the marker does indeed predict well, many patients will not need to undergo a painful biopsy.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(dca)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># keeping variable for binary outcome examples</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">data</span>(dca.df)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">dca.df =<span class="st"> </span>dca.df[, <span class="kw">c</span>(<span class="st">"patientid"</span>, <span class="st">"cancer"</span>, <span class="st">"age"</span>, <span class="st">"risk_group"</span>, <span class="st">"famhistory"</span>, <span class="st">"marker"</span>, <span class="st">"cancerpredmarker"</span>)]</a></code></pre></div>
</div>
<div id="univariate-decision-curve-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#univariate-decision-curve-analysis" class="anchor"></a>Univariate Decision Curve Analysis</h2>
<p>First, we want to confirm family history of cancer is indeed associated with the biopsy result.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">#Test whether family history is associated with cancer</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">summary</span>(<span class="kw">glm</span>(cancer <span class="op">~</span><span class="st"> </span>famhistory, <span class="dt">data =</span> dca.df, <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">"logit"</span>)))</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; glm(formula = cancer ~ famhistory, family = binomial(link = "logit"), </span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;     data = dca.df)</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; Deviance Residuals: </span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; -0.6842  -0.5224  -0.5224  -0.5224   2.0294  </span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; (Intercept)  -1.9227     0.1190 -16.163   &lt;2e-16 ***</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; famhistory    0.5899     0.2585   2.282   0.0225 *  </span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt;     Null deviance: 607.45  on 749  degrees of freedom</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt; Residual deviance: 602.60  on 748  degrees of freedom</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#&gt; AIC: 606.6</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="co">#&gt; Number of Fisher Scoring iterations: 4</span></a></code></pre></div>
<p>Via logistic regression with cancer as the outcome, we can see that family history is related to biopsy outcome (OR 1.80; 95% CI 1.09, 2.99; p=0.022). The DCA can help us address the clinical utility of using family history to predict biopsy outcome.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">#Run the decision curve: family history is coded as 0 or 1, i.e. a probability</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#so no need to specify the “probability” option</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">results =<span class="st"> </span><span class="kw"><a href="../reference/dca.html">dca</a></span>(<span class="dt">data=</span>dca.df, <span class="dt">outcome=</span><span class="st">"cancer"</span>, <span class="dt">predictors=</span><span class="st">"famhistory"</span>)</a></code></pre></div>
<p><img src="binary-outcomes_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>First, note that there are many threshold probabilities shown here that are not of interest. For example, it is unlikely that a patient would demand that they had at least a 50% risk of cancer before they would accept a biopsy. Let’s do the DCA again, this time restricting the output to threshold probabilities a more clinically reasonable range, between 0% and 35% with the xstop option.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">results =<span class="st"> </span><span class="kw"><a href="../reference/dca.html">dca</a></span>(<span class="dt">data=</span>dca.df, <span class="dt">outcome=</span><span class="st">"cancer"</span>, <span class="dt">predictors=</span><span class="st">"famhistory"</span>, <span class="dt">xstop=</span><span class="fl">0.35</span>)</a></code></pre></div>
<p><img src="binary-outcomes_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>Now that the graph is showing a more reasonable range of threshold probabilities, let’s assess the clinical utility of family history alone. We can see here that although family history is significantly associated with biopsy outcome, it only adds value to a small range of threshold probabilities near 13% -20%. If your personal threshold probability is 15% (i.e. you would undergo a biopsy if your probability of cancer was greater than 15%), then family history alone can be beneficial in making the decision to undergo biopsy. However, if your threshold probability is less than 13% or higher than 20%, then family history adds no more benefit than a biopsy all, or biopsy none scheme.</p>
</div>
<div id="multivariable-decision-curve-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#multivariable-decision-curve-analysis" class="anchor"></a>Multivariable Decision Curve Analysis</h2>
<div id="evaluation-of-new-models" class="section level3">
<h3 class="hasAnchor">
<a href="#evaluation-of-new-models" class="anchor"></a>Evaluation of New Models</h3>
<p>We wanted to examine the value of a statistical model that incorporates family history, age, and the marker. First we will build the logistic regression model with all three variables, and second we would have saved out the predicted probability of having cancer based on the model. Note that in our example dataset, this variable actually already exists so it wouldn’t be necessary to create the predicted probabilities once again.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">#run the multivariable model</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">model =<span class="st"> </span><span class="kw">glm</span>(cancer <span class="op">~</span><span class="st"> </span>marker <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>famhistory, <span class="dt">data =</span> dca.df, <span class="dt">family=</span><span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">"logit"</span>))</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#save out predictions in the form of probabilities</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">dca.df<span class="op">$</span>cancerpredmarker =<span class="st"> </span><span class="kw">predict</span>(model, <span class="dt">type=</span><span class="st">"response"</span>)</a></code></pre></div>
<p>We now want to compare our different approaches to cancer detection: biopsying everyone, biopsying no-one, biopsying on the basis of family history, or biopsying on the basis of a multivariable statistical model including the marker, age and family history of cancer.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">results =<span class="st"> </span><span class="kw"><a href="../reference/dca.html">dca</a></span>(<span class="dt">data=</span>dca.df, <span class="dt">outcome=</span><span class="st">"cancer"</span>, <span class="dt">predictors=</span><span class="kw">c</span>(<span class="st">"cancerpredmarker"</span>,<span class="st">"famhistory"</span>), </a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="dt">xstop=</span><span class="fl">0.35</span>)</a></code></pre></div>
<p><img src="binary-outcomes_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>The key aspect of decision curve analysis is to look at which strategy leads to the largest net benefit (i.e. the “highest” line), which in this example would correspond to the model that includes age, family history of cancer, and the marker. It is clear that, across the range of reasonable threshold probabilities, one cannot go wrong basing decisions on this multivariate model: it is superior, and unlike any alternative strategy, it is never worse.</p>
<p>A few points are worth noting. First, look at the green line, the net benefit for “treat all”, that is, biopsy everyone. This crosses the y axis at the prevalence. Imagine that a man had a risk threshold of 14%, and asked his risk under the “biopsy all” strategy. He would be told that his risk was the prevalence (14%). When a patient’s risk threshold is the same as his predicted risk, the net benefit of biopsying and not biopsying are the same.</p>
<p>Second, the decision curve for the binary variable (family history of cancer, the brown line) crosses the “biopsy all men” line at 1 – negative predictive value and again, this is easily explained: the negative predictive value is 87%, so a patient with no family history of cancer has a probability of disease of 13%; a patient with a threshold probability less than this – for example, a patient who would opt for biopsy even if risk was 10% - should therefore be biopsied even if he/she had no family history of cancer. The decision curve for a binary variable is equivalent to biopsy no-one at the positive predictive value. This is because for a binary variable, a patient with the characteristic is given a risk at the positive predictive value.</p>
</div>
<div id="evaluation-of-published-models" class="section level3">
<h3 class="hasAnchor">
<a href="#evaluation-of-published-models" class="anchor"></a>Evaluation of Published Models</h3>
<p>Imagine that a model was published by Brown et al. with respect to our cancer biopsy data set. The authors reported a statistical model with coefficients of 0.75 for a positive family history of cancer; 0.26 for each increased year of age, and an intercept of -17.5. To test this formula on our dataset:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co">#Use the coefficients from the Brown model</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">dca.df<span class="op">$</span>logodds_Brown =<span class="st"> </span><span class="fl">0.75</span><span class="op">*</span>(dca.df<span class="op">$</span>famhistory)<span class="op">+</span><span class="fl">0.26</span><span class="op">*</span>(dca.df<span class="op">$</span>age)<span class="op">-</span><span class="fl">17.5</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#Convert to predicted probability</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">dca.df<span class="op">$</span>phat_Brown =<span class="st"> </span><span class="kw">exp</span>(dca.df<span class="op">$</span>logodds_Brown)<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span><span class="kw">exp</span>(dca.df<span class="op">$</span>logodds_Brown))</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#Run the decision curve</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">results =<span class="st"> </span><span class="kw"><a href="../reference/dca.html">dca</a></span>(<span class="dt">data=</span>dca.df, <span class="dt">outcome=</span><span class="st">"cancer"</span>, <span class="dt">predictors=</span><span class="st">"phat_Brown"</span>, <span class="dt">xstop=</span><span class="fl">0.35</span>)</a></code></pre></div>
<p><img src="binary-outcomes_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>This decision curve suggests that although the model might be useful in the most risk averse patients, it is actually harmful in patients with more moderate threshold probabilities. As such, the Brown et al. model should not be used in clinical practice. This effect, a model being harmful, occurs due to miscalibration, that is, when patients are given risks that are too high or too low. Note that miscalibration only occurs rarely when models are created and tested on the same data set, such as in the example where we created a model with both family history and the marker.</p>
</div>
</div>
<div id="joint-or-conditional-tests" class="section level2">
<h2 class="hasAnchor">
<a href="#joint-or-conditional-tests" class="anchor"></a>Joint or Conditional Tests</h2>
<p>Many decisions in medicine are based on joint or conditional test results. A classic example is where patients are categorized on the basis of a test as being at high, low or intermediate risk. Patients at high risk are referred immediately for treatment (in our example biopsied); patients at low risk are reassured and advised that no further action is necessary; patients at intermediate risk are sent for an additional test, with subsequent treatment decisions made accordingly.</p>
<p>Imagine that for our example there was a previous test that categorized our patients as high, low, and intermediate risk of cancer and we wanted to incorporate our marker. There are five clinical options: 1. Biopsy everyone 2. Biopsy no-one 3. Biopsy everyone that was determined to be at high risk of cancer; don’t use the marker 4. Measure the marker for everyone, then biopsy anyone who is either at high risk of cancer or who was determined to have a probability of cancer past a certain level, based on the marker (i.e. joint approach) 5. Biopsy everyone at high risk; measure the marker for patients at intermediate risk and biopsy those with a probability of cancer past a certain level, based on the marker (i.e. conditional approach)</p>
<p>Decision curve analysis can incorporate joint or conditional testing. All that is required is that appropriate variables are calculated from the data set; decision curves are then calculated as normal. First we would create the variables to represent our joint and conditional approach. For our example, let us use 0.15 as the cutoff probability level for patients who had their marker measured and should be biopsied.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">#Create a variable for the strategy of treating only high risk patients</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#This will be 1 for treat and 0 for don’t treat</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">dca.df<span class="op">$</span>high_risk =<span class="st"> </span><span class="kw">ifelse</span>(dca.df<span class="op">$</span>risk_group<span class="op">==</span><span class="st">"high"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#Treat based on Joint Approach</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">dca.df<span class="op">$</span>joint =<span class="st"> </span><span class="kw">ifelse</span>(dca.df<span class="op">$</span>risk_group<span class="op">==</span><span class="st">"high"</span> <span class="op">|</span><span class="st"> </span>dca.df<span class="op">$</span>cancerpredmarker <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.15</span>, <span class="dv">1</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co"># Treat based on Conditional Approach</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">dca.df<span class="op">$</span>conditional =<span class="st"> </span><span class="kw">ifelse</span>(dca.df<span class="op">$</span>risk_group<span class="op">==</span><span class="st">"high"</span> <span class="op">|</span><span class="st"> </span>(dca.df<span class="op">$</span>risk_group<span class="op">==</span><span class="st">"intermediate"</span> <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8">dca.df<span class="op">$</span>cancerpredmarker <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.15</span>), <span class="dv">1</span>, <span class="dv">0</span>)</a></code></pre></div>
<p>Now that we have the variables worked out, we can run the decision curve analysis.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">results =<span class="st"> </span><span class="kw"><a href="../reference/dca.html">dca</a></span>(<span class="dt">data=</span>dca.df, <span class="dt">outcome=</span><span class="st">"cancer"</span>, <span class="dt">predictors=</span><span class="kw">c</span>(<span class="st">"high_risk"</span>, <span class="st">"joint"</span>, </a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">"conditional"</span>), <span class="dt">xstop=</span><span class="fl">0.35</span>)</a></code></pre></div>
<p><img src="binary-outcomes_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>This appears to show that the joint test is the better option for the range of threshold probabilities from 5% - 24% since it has the highest net benefit across that range. Less than 5%, the clinical option of treating all would be superior to any other option, though rarely would treatment thresholds be so low. From 28%-35%, the conditional test would be a slightly better option, and in between the two ranges, the joint and conditional tests are comparable. The obvious disadvantage of the joint test is that the marker needs to be measured for everyone, and such tests may be expensive and time consuming.</p>
</div>
<div id="incorporating-harms-into-model-assessment" class="section level2">
<h2 class="hasAnchor">
<a href="#incorporating-harms-into-model-assessment" class="anchor"></a>Incorporating Harms into Model Assessment</h2>
<p>To incorporate the harm of testing and measuring the marker, we ask a clinician, who tells us that, even if the marker were perfectly accurate, few clinicians would conduct more than 30 tests to predict one cancer diagnosis. This might be because the test is expensive, or requires some invasive procedure to obtain. The “harm” of measuring the marker is the reciprocal of 30, or 0.0333.</p>
<p>To construct the decision curves for each strategy we now incorporate harm. We have to calculate harm specially for the conditional test, because only patients at intermediate risk are measured for the marker. Then incorporate it into our decision curve. The strategy for incorporating harm for the conditional test is by multiplying the proportion scanned by the harm of the scan.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co">#the harm of measuring the marker is stored in a scalar</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">harm_marker =<span class="st"> </span><span class="fl">0.0333</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#in the conditional test, only patients at intermediate risk </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#have their marker measured</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">dca.df<span class="op">$</span>intermediate_risk =<span class="st"> </span><span class="kw">ifelse</span>(dca.df<span class="op">$</span>risk_group<span class="op">==</span><span class="st">"intermediate"</span>, <span class="kw">c</span>(<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#harm of the conditional approach is proportion of patients who have the marker #measured multiplied by the harm</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7">harm_conditional =<span class="st"> </span><span class="kw">mean</span>(dca.df<span class="op">$</span>intermediate_risk)<span class="op">*</span>harm_marker</a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#Run the decision curve</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9">results =<span class="st"> </span><span class="kw"><a href="../reference/dca.html">dca</a></span>(<span class="dt">data=</span>dca.df, <span class="dt">outcome=</span><span class="st">"cancer"</span>, <span class="dt">predictors=</span><span class="kw">c</span>(<span class="st">"high_risk"</span>, <span class="st">"joint"</span>,</a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="st">"conditional"</span>), <span class="dt">harm=</span><span class="kw">c</span>(<span class="dv">0</span>, harm_marker, harm_conditional),</a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="dt">xstop=</span><span class="fl">0.35</span>)</a></code></pre></div>
<p><img src="binary-outcomes_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>Here the conditional test is clearly the best option (above the 8% treatment threshold), in fact, once you take into account the harm of measuring the marker, it is clearly not worth measuring the marker for everyone: the net benefit of just treating high risk patients is often higher than that of the joint test.</p>
</div>
<div id="interventions-avoided" class="section level2">
<h2 class="hasAnchor">
<a href="#interventions-avoided" class="anchor"></a>Interventions Avoided</h2>
<p>As part of assessing the usefulness of the marker, we would be interested in whether using this marker to identify patients with and without cancer would help reduce unnecessary biopsies. This value was the “intervention avoided” column in the table that was saved out. To view it graphically, we would only need to specify it in our command.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">results =<span class="st"> </span><span class="kw"><a href="../reference/dca.html">dca</a></span>(<span class="dt">data=</span>dca.df, <span class="dt">outcome=</span><span class="st">"cancer"</span>, <span class="dt">predictors=</span><span class="st">"marker"</span>, <span class="dt">probability=</span><span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="dt">intervention=</span><span class="ot">TRUE</span>, <span class="dt">xstart=</span><span class="fl">0.05</span>, <span class="dt">xstop=</span><span class="fl">0.35</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt; [1] "marker converted to a probability with logistic regression. Due to linearity assumption, miscalibration may occur."</span></a></code></pre></div>
<p><img src="binary-outcomes_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>At a probability threshold of 15%, the net reduction in interventions is about 33 per 100 patients. In other words, at this probability threshold, biopsying patients on the basis of the marker is the equivalent of a strategy that reduced the biopsy rate by 33%, without missing any cancers.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction-background">Introduction &amp; Background</a></li>
      <li><a href="#motivating-example">Motivating Example</a></li>
      <li><a href="#univariate-decision-curve-analysis">Univariate Decision Curve Analysis</a></li>
      <li><a href="#multivariable-decision-curve-analysis">Multivariable Decision Curve Analysis</a></li>
      <li><a href="#joint-or-conditional-tests">Joint or Conditional Tests</a></li>
      <li><a href="#incorporating-harms-into-model-assessment">Incorporating Harms into Model Assessment</a></li>
      <li><a href="#interventions-avoided">Interventions Avoided</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Daniel D. Sjoberg.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
